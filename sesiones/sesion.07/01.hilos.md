# ðŸ§­ SesiÃ³n 7 Â· Punto 1 â€” Concurrencia con Hilos (`threading`, `ThreadPool`)

## ðŸŽ¯ Objetivos especÃ­ficos

* Comprender quÃ© son los **hilos (threads)** en Python.
* Aprender a crear y gestionar hilos con el mÃ³dulo `threading`.
* Usar **bloqueos (`Lock`)** para evitar condiciones de carrera.
* Introducir **ThreadPool** como abstracciÃ³n para paralelizar tareas fÃ¡cilmente.

---

## ðŸ“š Resumen teÃ³rico-prÃ¡ctico

### ðŸ”¹ Concepto

* Un **hilo** es una unidad de ejecuciÃ³n dentro de un proceso.
* Python usa el **GIL (Global Interpreter Lock)**, lo que significa que los hilos no ejecutan bytecode en paralelo en CPU, pero **sÃ­ permiten concurrencia en operaciones I/O** (ficheros, red, bases de datos).
* Para tareas de **CPU intensivo**, es preferible `multiprocessing` (veremos en SesiÃ³n 8).

---

### ðŸ”¹ Ejemplo bÃ¡sico con `threading.Thread`

```python
import threading
import time

def tarea(nombre):
    for i in range(3):
        print(f"[{nombre}] iteraciÃ³n {i}")
        time.sleep(1)

# Crear hilos
t1 = threading.Thread(target=tarea, args=("Hilo-1",))
t2 = threading.Thread(target=tarea, args=("Hilo-2",))

t1.start()
t2.start()

t1.join()
t2.join()
print("Fin de ejecuciÃ³n")
```

ðŸ‘‰ Ambos hilos imprimen mensajes intercalados.

---

### ðŸ”¹ Uso de `Lock` para sincronizaciÃ³n

```python
import threading

contador = 0
lock = threading.Lock()

def incrementar():
    global contador
    for _ in range(100000):
        with lock:            # garantiza exclusiÃ³n mutua
            contador += 1

hilos = [threading.Thread(target=incrementar) for _ in range(4)]
for h in hilos: h.start()
for h in hilos: h.join()

print("Contador final:", contador)  # esperado: 400000
```

ðŸ‘‰ Sin `lock`, el resultado puede ser menor por **condiciones de carrera**.

---

### ðŸ”¹ ThreadPoolExecutor (API moderna)

```python
from concurrent.futures import ThreadPoolExecutor
import time

def cuadrado(n):
    time.sleep(1)
    return n*n

with ThreadPoolExecutor(max_workers=3) as pool:
    numeros = [1, 2, 3, 4, 5]
    resultados = list(pool.map(cuadrado, numeros))

print("Resultados:", resultados)
```

ðŸ‘‰ Lanza hasta 3 hilos concurrentes para procesar la lista.

---

## ðŸ§© Mini-ejercicios rÃ¡pidos

1. Crea un hilo que descargue datos desde una URL (usa `requests.get`) mientras otro procesa un archivo local.
2. Implementa un contador global con 5 hilos incrementando a la vez; prueba **con y sin lock**.
3. Usa `ThreadPoolExecutor` para calcular los factoriales de una lista de nÃºmeros.

---

## âœ… Checklist de dominio

* [ ] Â¿SÃ© crear hilos con `threading.Thread` y ejecutarlos con `start()` + `join()`?
* [ ] Â¿Entiendo el papel de los **Locks** en evitar condiciones de carrera?
* [ ] Â¿SÃ© usar `ThreadPoolExecutor` para simplificar concurrencia en colecciones?
* [ ] Â¿Comprendo que en Python los hilos benefician tareas **I/O**, no tanto CPU por el GIL?